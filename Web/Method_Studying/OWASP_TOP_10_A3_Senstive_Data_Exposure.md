#Mentoring_Web #OWASP_TOP_10

세번째 문제는 Sensitive Data Exposure이다. 하나 알아둬야 할 것이 있다. 개발자의 실수 혹은 실력 부족으로 발생한 오류등의 문제도 취약점이 될 수 있다. 취약점이라는게 큰 단위에서 발생하는것이 아닌, 코드 한줄의 오류로도 발생할 수 있다. 이러한 관점에서 취약점을 생각해야 한다.
많은 웹 앱과 API들이 민감한 데이터를 적절히 보호하지 않는다. 공격자들은 이렇게 약하게 보호된 데이터를 훔치거나 수정해 여러가지 문제를 발생시킨다. 민감한 데이터들은 브라우저를 통해 교환될 때 특별히 주의해야 한다.

우선 익스플로잇 가능성은 중간인 2점이다. 암호화된 데이터를 공격하는 것이 아닌, 공격자들은 키를 취득하려 하고, 따라서 중간자 공격을 시도한다. 아니면 암호화되지 않은 평문을 서버로 전달되는 과정이나 유저의 클라이언트에서 취득하려 한다. Manual 공격이 일반적으로 필요하다. 이전에 얻어진 패스워드 데이터베이스는 GPU를 통해 브루트 포스 공격에 이용될 수 있다.

존재 가능성은 3점이고, 발견 가능성은 2점이다. 민감한 데이터 노출은 최근 몇년간 가장 일반적이고, 임팩트가 큰 공격이었다. 가장 큰 문제는 민감한 데이터를 암호화하지 않아 발생한다. 암호화가 사용되어도, 약한 키 생성과 관리, 그리고 약한 알고리즘, 프로토콜과 사이퍼 사용이 되고, 특히 비밀번호 암호화 방식에 문제가 있을대 문제가 발생할 수 있다. 데이터를 전송할 때 서버사이드의 문제는 발견하기 쉽지만, 다른 경우에는 발견하기 어렵다.

기술적인 영향은 3점으로 가장 높다. 이 문제는 보호되어야 하는 데이터들이 유출되는 문제를 발생시킬 수 있다. 일반적으로, 이러한 정보는 건강 기록같은 법적으로 관리되어야 하는 민감한 데이터를 공격한다.

첫번째 문제는, 전달 과정과 다른 과정에서 데이터 보호의 필요성을 판단하는 것이다.여러가지 데이터들은 법의 정책 내에서 관리되어야 한다. 다음과 같은 경우에서 취약점이 발생할 수 있다.

-- 데이터가 평문으로 전송되는가?  이 문제는 http, smtp, ftp등의 프로토콜을 사용할 때 발생한다. 외부의 인터넷 트래픽은 더 위험할 수 이싸. 모든 인터넷 데이터 전송과정을 암호화해라. 로드 밸런서나 웹서버, 백엔드 시스템까지도.
-- 민감한 데이터가 평문으로 저장되는가? 백업 데이터도 확인해야 한다.
-- 오래되거나 약한 암호 알고리즘이 기본 혹은 오래된 코드에 사용되었는가?
-- 암호화 기본 키가 사용되거나, 약한 암호화 키가 생성되어 사용되거나 재활용 되는가? 아니면 적절한 키 관리와 로테이션이 이루어지는가?
-- 암호화가 항상 이루어지고 있는가? 어떠한 유저도 보안적 지시나 헤더를 무시하고 있지 않은가?
-- 유저가 받는 서버의 데이터를 무시하고 있지 않은가?

예방법은 다음과 같다
-- 하나의 프로그램에 어떤 데이터가 처리되고, 저장, 전송되는지 분류하고, 어떠한 데이터가 법적으로 보호받는 등의 예민한 데이터인지 구분하라.
-- 이러한 분류에 따라 관리를 적용해야 한다.
-- 불필요한 민감 데이터 저장을 피하라. 최대한 빨리 민감한 데이터를 지우거나 pci dss 토큰이나 truncation 등을 사용하라. 데이터가 저장되어 있지 않으면 훔칠수도 없다.
-- 모든 민감 데이터가 암호화되어있는지 확인하자.
-- 최신의 강한 표준 알고리즘, 프로토콜을 사용하는지 확인하고, 키가 적절한 위치에서 관리되고 있는지 확인하자.
-- 데이터의 전송 과정에서 모두 TLS with PFS cipher 등의 암호화 프로토콜을 이용해 암호화되고 있는지 확인하자. 암호화 과정을 항상 암호화가 이루어지도록 HSTS등의 정책을 사용하자.
-- 민감한 정보를 포함한 데이터를 catching하지 않도록 비활성화 하자,
-- 비밀번호를 강력한 적응형 해쉬 함수를 딜레이 펙터와 함꼐 사용하도록 하자. Argon2, scrypt, bcrypt, PBKDF2등이 이에 해당된다.
-- 환경 설정의 효율성을 독립적으로 확인하자.

가능한 공격 시나리오는 다음과 같다.
-- 어플리케이션이 신용 카드 번호를 DB에서 자동 암호화로 암호화했을 때,이 데이터는 읽을때 자동으로 복호화되고, sql 인젝션 공격이 작동할 때 평문으로 된 카드번호를 얻을 수 있다.
-- 사이트가 TSL를 사용하도록 강제하지 않았을 대, 공격자는 트래픽을 모니터링 하고, 연결을 암호화가 없는 HTTP를 사용하도록 할 수 있다. 이 데이터를 취득해 유저의 세션 쿠키를 훔칠 수 있다 . 그러면 공격자는 모니터링한 모든 데이터를 변환하는 대신, 이 쿠키를 재사용해 인증받은 세션을 훔쳐 유저의 개인 데이터에 접근할 수 있다
-- 패스워드 DB가 salted되지 않거나 간단한 해쉬를 비밀번호 저장에 사용한다면 , 공격자는 파일 업로드를 통해 패스워드 DB를 접근하려는 시도를 할 수 있다. 모든 unsalted 해쉬함수는 미리 계산된 hash와 함꼐 레인보우 해쉬로 제공될 수 있다. 간단하거나 빠른 해쉬 함수들은 salted 처리가 되었어도 빠르개 해킹될 수 있다.
(*salted 보안을 위해 패스워드를 DB에 입력할 때 소금을 치듯 추가적인 데이터를 입력하는 것이다.)

이정도인 것 같다.