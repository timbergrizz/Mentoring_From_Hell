#Mentoring_Web #OWASP_TOP_10

Insecure Deserialization이다. 이 공격은 보통 원격 코드 실행으로 이루어진다.  이러한 역직렬화 취약첨이 코드 삽입으로 이어지지 않아도, 리플레이 공격, 인젝션 공격, 권한 상승 공격에 사용될 수 있다.

직렬화에 관한 이야기는 XXE에 설명되어있으니 가서 찾아읽어라.

우선 공격 가능성은 낮은 1점이다. 역직렬화 문제의 공격 가능성은 기본 익스플로잇 코드를 변경하지 않고는 작동하지 않기 때문에 어렵다. 

존재 가능성과 발견 가능성은 모두 2점이다. 이 문제는 업계 설문조사로 Top 10 문서에 추가되었지만, 양적으로 충분한 데이터가 존재하지 않는다. 몇가지 툴들을 이러한 문제를 발견할 수 있지만 이 문제를 확인하기 위해서는 어쨌거나 사람의 손이 가야한다. 이 취약점에 대해 존재하는 데이터가 이를 발견하고 수정하는 툴들을 발전시키는데 도움이 될 것이다.

기술적 영향은 3점으로 높다. 이 취약점은 과소평가 될 수 없다. 이 취약점을 통해 가장 문제가 될 수 있는 공격인 원격 코드 삽입이 이루어 질 수 있다.

이러한 공격에 취약한 경우를 다시 알아보자. 어플리케이션과 API는 공격 객체나 tampered된 객체를 공격자에 의해 역직렬화 될 떄 취약하다. 이것은 두가지 공격으로 이어질 수 있다.

-- 객체와 데이터 구조와 관련된 공격. 역직렬화가 실행중이거나 실행 된 후 어플리케이션의 행동을 수정할 수 있는 클래스가 있을 때 공격자가 어플리케이션의 로직을 수정하거나 임의로 코드 삽입 공격을 수행한다.
-- Typical 데이터를 tampering하는 access-control과 관련된 공격. 이미 사용중인 데이터 구조를 사용하지만 내용이 바뀌게 된다.

직렬화는 이러한 어플리케이션에서 사용된다
-- 원격, 상호 과정 커뮤니케이션 (RPC ./ IPC)
-- wire 프로토콜, 웹서비스, 메시지 전달자.
-- 캐싱, 유지/보수
-- DB, 캐싱 서버, 파일 시스템
-- HTTP 쿠키, HTML 폼 파라미터, API 인증 토큰

유일한 안전한 구조는 직렬화된 객체를 신뢰할 수 없는 출처에서 허용하지 않거나, 원시적 데이터 타입을 가진 직렬화 매채만 사용하는것이다. 이것이 불가능하다면, 다음과 같은 방법을 시도하라
-- 모든 직렬화 객체에 디지털 서명같은 integrity 확인을 삽입해 공격을 위한 객체 생선과 데이터 템피렁을 막는다
-- 역직렬화 과정에서 객체 생성 이전에 코드가 일반적으로 디파인 가능한 클래스를 사용하려 할 떄 strict 타입을 사용하도록 강제하라.
-- 낮은 권한이 있는 환경에서 역직렬화 할 때 코드를 독립시켜 실행하라
-- 역직렬화 과장의 예외 처리와 오류를 로깅하라. 예를 들어 입력한 데이터가 예상한 타입이 아닌 경우나 역직렬화가 예외처리 될때.
-- 역직렬화를 하는 컨테이너나 서버에서 네트워크 연결을 제한하거나 모니터링해라.
-- 역직렬화를 모니터링하고, 유저가 역직렬화를 꾸준히 한다면 알림을 관리자에게 울려라.

공격 시나리오를 살펴보자.

첫번째 시나리오다. 리액트 어플리케이션이 스프링 부트 마이크로서비스를 호출할 때 발생한다. 함수형 프로그래밍 언어에서, 프로그래머들은 코드를 불변하도록 보장하고자 한다. 프로그래머들이 생각해낸 방법은 유저의 state를 직렬화하고 이를 각각의 요청에서 전달하도록 하는 것이다. 공격자는 R00 자바 객체 시그니처를 인지하고 Java Serial Killer를 사용해 어플리케이션에 원격 코드를 삽입한다.

두번째 시나리오다. PHP 포럼은 PHP 객체 직렬화를 사용해 super cookie를 저장하는데, 이 쿠키에는 user의 id와 권한, 비밀번호 헤쉬등을 저장한다. 공격자는 이 직렬화된 객체를 수정해 개발자의 권한을 얻게 된다.

여튼 그러하다. 아래로 내려갈수록 어려워진다.