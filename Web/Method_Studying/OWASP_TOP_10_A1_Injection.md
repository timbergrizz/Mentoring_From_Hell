#Mentoring_Web #OWASP_TOP_10

우선 injection이다. Injection 취약점은 SQL같은 데이터베이스를 공격하고, 신뢰할 수 없는 데이터가 쿼리로 전달될 때 발생할 수 있다. 이를 통해 의도하지 않은 명령어 입력이나 권한에 맞지 않는 데이터 획득을 일으킬 수 있다.

모든 종류의 데이터는 공격 수단이 될 수 있고, interpreter에게 공격 데이터가 전달될 때 발생할 수 있어 공격 가능성이 높다.

존재 가능성도 높다. 특히 예전에 사용되던 코드에서 발견 될 수 있고, SQL, LADP, XPath, NoSQL 쿼리, OS 명령어, XML parser 기타등등 입력받는 데이터에서 모두 발생할 수 있다.

코드를 조사할 때 발견하기도 쉽다. 공격자들은 스캐너와 퍼저로 이러한 취약점을 찾을 수 있다.

이러한 인젝션 공격으로 데이터 손실이나 오염, 데이터의 유출 등을 일으킬 수 있다. 사업에서의 영향력은 데이터의 필요에 따라 달라진다.

유저에게 받은 데이터가 검증되거나, 필터링되지 않았을 때 / 다이나믹 쿼리나 파라미터화 되지 않은 호출이 상황에 관계 없이 인터프리터에게 전달되었을.때 / 공격 데이터가 ORM내부에서 민감한 기록들을 검색하는데 사용될 때 / 공격 데이터가 sql등의 직접 사용될 때 공격이 발생할 수 있다.

가장 많이 사용되는 인젝션은 SQL, NoSQL, OS 명령어, ORM, LDAP, EL, OGNL이다. 개념 자체는 모든 언어, 인터프리터에서 동일하다. 소스코드를 검토하는 것이 발견하는 최선의 방법이고, 데이터를 입력하는 모든 방법을 검토하는 것도 좋은 방법이다.

인젝션을 방어하는 방법으로는 데이터를 명령어와 쿼리에서 분리하는 것이다. 인터프리터의 사용을 막거나 parameterized 인터페이스를 제공하는 안전한 API를 사용하고, ORMs로 이전하는 것이다. 

또다른 방어 방법으로 서버단에서 입력을 검증하는 화이트리스트를 사용하는 것이다. 많은 어플리케이션들이 특수 문자를 사용하기 때문에 완벽한 방법은 아니다.

또 다른 방어 방법으로는 다이나믹 쿼리를 사용할때 사용 될 수 있는 특수 문자들을 escape문으로 처리하는 것이다. 이때, 테이블 이름, 컬럼 이름등의 sqk 구조명은 escape문으로 처리할 수 없다. 그러므로 유저가 제공한 구조명은 위험할 수 있다.

마지막 방어 기법은 query문에서 LIMIT명령어를 쓰는 것, 그리고 다른 sql의 제어문을 사용하는 것이다. 이는 sql 인젝션에서 데이터 유출을 막을 수 있다.

![](img/1-01.jpg)

취약점 발생 예시를 조금 살펴보자. 어플리케이션이 데이터를 함수로 직접 받아 들일 때 신뢰할 수 없는 데이터가 들어오면 문제가 발생할 수 있다.

![](img/1-02.jpg)

두번째 시나리오도 유사한데, 프레임워크 내에서 응용 프로그램이 미리 신뢰를 획득하게 되어도 취약점이 발생할 수 있다. 주로 HQL에서 발생한다는데 일단 HQL이 뭔지부터 모르갰다. 찾아보니까 자바에서 사용하는 객체 관계를 RDB로 묶기 위한 프레임워크란다. 진짜 별게 다 있다.

이러한 공격을 통해, 공격자는 데이터베이스의 모든 공격을 유출시킬수 있고, 조금 더 위험한 공격으로 데이터를 수정하거나 삭제하고, 저장된 순서를 invoke할수도 있다는데 invoke가 어떤 의미로 쓰인건질 모르겠다. 저장 순서를 섞는다는건가?

여튼 injection은 여기까지.